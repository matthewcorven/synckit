# A3-01: Create JWT Validator Service

> **Summary:** Create a service to validate JWT tokens using HS256 algorithm with shared secret, matching the TypeScript server's validation logic.

[← Back to Phase 3](README.md) | [Phase Document](../PHASE-3-AUTH.md)

---

**Priority:** P0  
**Estimate:** 6 hours  
**Dependencies:** P2-02

## Description

Create a service to validate JWT tokens using the same algorithm as the TypeScript server (HS256 with shared secret).

## Tasks

1. Create `IJwtValidator.cs` interface
2. Create `JwtValidator.cs` implementation
3. Support HS256 algorithm
4. Validate token claims (iss, aud, exp, iat)
5. Extract permissions from token

## Token Structure

Implementation aligns with the TypeScript reference server: the validator returns a `TokenPayload` containing user identity and `DocumentPermissions`.

```csharp
public class TokenPayload
{
    public string UserId { get; set; } = null!; // from `sub` claim
    public string? Email { get; set; }
    public DocumentPermissions Permissions { get; set; } = new();
    public long? Iat { get; set; }
    public long? Exp { get; set; }
}

public class DocumentPermissions
{
    public string[] CanRead { get; set; } = Array.Empty<string>();
    public string[] CanWrite { get; set; } = Array.Empty<string>();
    public bool IsAdmin { get; set; }
}
```

## Acceptance Criteria

- [x] Valid tokens return `TokenPayload` (implemented by `JwtValidator.Validate`)
- [x] Invalid tokens return `null` (signature/claim checks/logging)
- [x] Expired tokens rejected (lifetime enforced, `ClockSkew=0`)
- [x] Issuer validated when configured (`ValidateIssuer` / `ValidIssuer`)
- [x] Audience validated when configured (`ValidateAudience` / `ValidAudience`)
- [x] Permissions extracted correctly (parses JSON `permissions` claim into `DocumentPermissions`)

---

**Status:** ✅ Completed
