# W5-05: Add Awareness Cleanup on Disconnect

> **Summary:** Clean up awareness state and notify other clients when a connection closes, sending null state to indicate offline status.

[← Back to Phase 5](README.md) | [Phase Document](../PHASE-5-AWARENESS.md)

---

**Priority:** P0  
**Estimate:** 2 hours  
**Dependencies:** W5-02, P2-08

## Description

Clean up awareness state and notify other clients when a connection closes.

## Disconnect Flow

1. Connection closes (graceful or timeout)
2. Get list of documents the connection was subscribed to
3. Remove awareness for this connection from store
4. Broadcast null state to remaining subscribers for each document

## Notification Format

```json
{
  "type": "awareness_update",
  "id": "msg-1",
  "timestamp": 1234567890,
  "documentId": "doc-1",
  "clientId": "disconnected-client",
  "state": null,
  "clock": 2
}
```

> **Note:** `state: null` indicates the client is offline.

## Acceptance Criteria

- [ ] Awareness removed on disconnect
- [ ] Other clients notified of offline status
- [ ] Null state indicates offline
- [ ] All subscribed documents notified

---

**Status:** ⬜ Not Started
