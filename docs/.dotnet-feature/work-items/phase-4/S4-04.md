# S4-04: Implement Subscribe Handler

> **Summary:** Handle SUBSCRIBE messages to add connections to document subscriptions and send initial state via SYNC_RESPONSE.

[← Back to Phase 4](README.md) | [Phase Document](../PHASE-4-SYNC-ENGINE.md)

---

**Priority:** P0  
**Estimate:** 4 hours  
**Dependencies:** S4-03, A3-06

## Description

Handle SUBSCRIBE messages to add connections to document subscriptions.

## Tasks

1. Create `SubscribeMessageHandler.cs`
2. Validate permissions
3. Add connection to document subscribers
4. Add document to connection's subscriptions
5. Send initial state via SYNC_RESPONSE

## Acceptance Criteria

- [ ] Auth required for subscribe
- [ ] Read permission required
- [ ] Document created if not exists
- [ ] Connection added to document subscribers
- [ ] SYNC_RESPONSE sent with current state
- [ ] Existing deltas included in response

---

**Status:** ⬜ Not Started
