# F1-04: Implement Health Endpoint

> **Summary:** Implement a health check endpoint that returns server statistics in JSON format, matching the TypeScript server's health endpoint, plus ASP.NET Core health checks for container orchestration.

[← Back to Phase 1](README.md) | [Phase Document](../PHASE-1-FOUNDATION.md)

---

**Priority:** P0  
**Estimate:** 4 hours  
**Dependencies:** F1-02, F1-03

## Description

Implement a health check endpoint that returns server statistics in JSON format, matching the TypeScript server's health endpoint.

## Tasks

1. Create HealthController
2. Implement health response model
3. Add server stats collection
4. Register endpoint routing
5. Add ASP.NET Core health checks for liveness/readiness

## Health Response Model

```csharp
public record HealthResponse
{
    public string Status { get; init; } = "ok";
    public string Version { get; init; } = "1.0.0";
    public long Uptime { get; init; }
    public HealthStats Stats { get; init; } = new();
}

public record HealthStats
{
    public int Connections { get; init; }
    public int Documents { get; init; }
    public long MemoryUsage { get; init; }
}
```

## ASP.NET Core Health Checks Integration

```csharp
// Program.cs
builder.Services.AddHealthChecks()
    .AddCheck("self", () => HealthCheckResult.Healthy(), tags: new[] { "live" });

// Liveness probe - is the process running?
app.MapHealthChecks("/health/live", new HealthCheckOptions
{
    Predicate = check => check.Tags.Contains("live")
});

// Readiness probe - can accept traffic? (expanded in Phase 6 with DB/Redis checks)
app.MapHealthChecks("/health/ready", new HealthCheckOptions
{
    Predicate = check => check.Tags.Contains("ready")
});
```

> **Note:** Kubernetes and Docker use separate liveness/readiness probes. The existing `/health` endpoint provides detailed stats for monitoring dashboards.

## Expected Response

```json
GET /health HTTP/1.1

{
  "status": "ok",
  "version": "1.0.0",
  "uptime": 12345,
  "stats": {
    "connections": 42,
    "documents": 100,
    "memoryUsage": 52428800
  }
}
```

## Acceptance Criteria

- [ ] `GET /health` returns 200 with JSON stats (matches TypeScript server)
- [ ] Response includes status, version, uptime, stats
- [ ] `GET /health/live` returns 200 (liveness probe)
- [ ] `GET /health/ready` returns 200 when ready (readiness probe)
- [ ] Uptime is accurate (seconds since start)

---

**Status:** ⬜ Not Started
