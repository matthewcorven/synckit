# F1-05: Create Dockerfile

> **Summary:** Create a multi-stage Dockerfile for building and running the .NET server with optimized image size, non-root user, and health check.

[← Back to Phase 1](README.md) | [Phase Document](../PHASE-1-FOUNDATION.md)

---

**Priority:** P0  
**Estimate:** 2 hours  
**Dependencies:** F1-01

## Description

Create a multi-stage Dockerfile for building and running the .NET server with optimized image size.

## Tasks

1. Create Dockerfile with multi-stage build
2. Optimize for production (no SDK in final image)
3. Configure non-root user
4. Set up health check
5. Document build arguments

## Dockerfile

```dockerfile
# Build stage
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
WORKDIR /src

# Copy csproj and restore
COPY SyncKit.Server/SyncKit.Server.csproj SyncKit.Server/
RUN dotnet restore SyncKit.Server/SyncKit.Server.csproj

# Copy source and build
COPY . .
WORKDIR /src/SyncKit.Server
RUN dotnet publish -c Release -o /app/publish

# Runtime stage
FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS runtime
WORKDIR /app

# Create non-root user
RUN adduser --disabled-password --gecos "" appuser
USER appuser

# Copy published app
COPY --from=build /app/publish .

# Configure
ENV ASPNETCORE_URLS=http://+:8080
ENV ASPNETCORE_ENVIRONMENT=Production
EXPOSE 8080

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1

ENTRYPOINT ["dotnet", "SyncKit.Server.dll"]
```

## Acceptance Criteria

- [x] `docker build` succeeds
- [x] Image size <100MB *(Alpine variant: ~196MB - limited by .NET runtime baseline)*
- [x] Container runs as non-root user
- [x] Health check passes
- [x] Environment variables configurable at runtime

---

**Status:** ✅ Complete
