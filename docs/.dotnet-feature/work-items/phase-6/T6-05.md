# T6-05: Create Storage Provider Factory

> **Summary:** Create factory to instantiate correct storage providers (in-memory or PostgreSQL) and optional Redis pub/sub based on configuration.

[← Back to Phase 6](README.md) | [Phase Document](../PHASE-6-STORAGE.md)

---

**Priority:** P0  
**Estimate:** 3 hours  
**Dependencies:** T6-02, T6-04

## Description

Create factory to instantiate correct storage providers based on configuration.

## Configuration

```json
{
  "Storage": {
    "Provider": "postgresql",  // "inmemory" | "postgresql"
    "PostgreSql": {
      "ConnectionString": "Host=localhost;Database=synckit;..."
    },
    "Redis": {
      "ConnectionString": "localhost:6379",
      "Enabled": true
    }
  }
}
```

## Extension Method

```csharp
public static IServiceCollection AddSyncKitStorage(
    this IServiceCollection services,
    IConfiguration configuration)
{
    var storageConfig = configuration.GetSection("Storage");
    var provider = storageConfig.GetValue<string>("Provider") ?? "inmemory";

    switch (provider.ToLowerInvariant())
    {
        case "postgresql":
        case "postgres":
            services.AddPostgreSqlStorage(storageConfig);
            break;
        case "inmemory":
        default:
            services.AddInMemoryStorage();
            break;
    }

    // Redis pub/sub (optional)
    if (storageConfig.GetValue<bool>("Redis:Enabled"))
    {
        services.AddRedisPubSub(storageConfig);
    }

    return services;
}
```

## Acceptance Criteria

- [ ] In-memory storage works by default
- [ ] PostgreSQL configurable
- [ ] Redis pub/sub optional
- [ ] Connection strings from config
- [ ] Factory validates configuration

---

**Status:** ⬜ Not Started
