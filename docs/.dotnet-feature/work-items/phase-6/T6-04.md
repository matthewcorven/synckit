# T6-04: Create Redis Pub/Sub Provider

> **Summary:** Implement Redis pub/sub for broadcasting delta and awareness messages across multiple server instances for horizontal scaling.

[← Back to Phase 6](README.md) | [Phase Document](../PHASE-6-STORAGE.md)

---

**Priority:** P0  
**Estimate:** 6 hours  
**Dependencies:** S4-06, W5-03

## Description

Implement Redis pub/sub for broadcasting messages across multiple server instances.

## Tasks

1. Create `IRedisPubSub.cs` interface
2. Create `RedisPubSubProvider.cs`
3. Subscribe to document channels
4. Publish delta and awareness updates
5. Handle reconnection

## Interface

```csharp
public interface IRedisPubSub
{
    Task PublishDeltaAsync(string documentId, DeltaMessage delta);
    Task PublishAwarenessAsync(string documentId, AwarenessUpdateMessage update);
    Task SubscribeAsync(string documentId, Func<IMessage, Task> handler);
    Task UnsubscribeAsync(string documentId);
    Task<bool> IsConnectedAsync();
}
```

## Channel Naming

| Channel | Pattern |
|---------|---------|
| Delta | `synckit:delta:{documentId}` |
| Awareness | `synckit:awareness:{documentId}` |

## Multi-Instance Flow

1. Client sends delta to Server A
2. Server A broadcasts to local subscribers
3. Server A publishes to Redis
4. Server B receives from Redis
5. Server B broadcasts to its local subscribers

## Acceptance Criteria

- [ ] Delta messages published to Redis
- [ ] Awareness messages published to Redis
- [ ] Subscriptions managed per document
- [ ] Messages from Redis forwarded to local connections
- [ ] Reconnection handled
- [ ] Graceful shutdown

---

**Status:** ⬜ Not Started
