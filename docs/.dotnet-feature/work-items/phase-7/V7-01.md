# V7-01: Set Up Test Environment

> **Summary:** Configure Docker Compose test environment with PostgreSQL, Redis, and .NET server to run the existing 410-test suite against the new implementation.

[← Back to Phase 7](README.md) | [Phase Document](../PHASE-7-TESTING.md)

---

**Priority:** P0  
**Estimate:** 4 hours  
**Dependencies:** All previous phases

## Description

Configure the test environment to run the existing test suite against the .NET server.

## Tasks

1. Update test configuration for .NET server
2. Create Docker Compose for test environment
3. Add test server startup scripts
4. Configure parallel test execution

## Docker Compose Configuration

```yaml
# server/csharp/src/docker-compose.test.yml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: synckit_test
      POSTGRES_USER: synckit
      POSTGRES_PASSWORD: synckit_test
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U synckit -d synckit_test"]
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 5s
      retries: 5

  synckit-dotnet:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - SYNCKIT__JWT__SECRET=test-secret-at-least-32-characters-long
      - STORAGE__PROVIDER=postgresql
      - STORAGE__POSTGRESQL__CONNECTIONSTRING=Host=postgres;Port=5432;Database=synckit_test;Username=synckit;Password=synckit_test
      - STORAGE__REDIS__ENABLED=true
      - STORAGE__REDIS__CONNECTIONSTRING=redis:6379
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
```

## Test Runner Script

```bash
#!/bin/bash
# server/csharp/src/run-tests.sh
set -e

echo "Starting test environment..."
docker compose -f docker-compose.test.yml up -d --build

# Run tests
cd ../../tests
export SYNCKIT_SERVER_URL=ws://localhost:8080/ws
bun test

# Cleanup
cd ../server/csharp
docker compose -f docker-compose.test.yml down
```

## Acceptance Criteria

- [ ] Docker Compose starts .NET server
- [ ] Health check waits for server ready
- [ ] Test suite can connect to .NET server
- [ ] Results captured and exported
- [ ] Parallel execution works

---

**Status:** ⬜ Not Started
